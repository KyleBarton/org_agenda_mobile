const fs = require('fs');
const path = require('path');

const FIXTURES_DIR = path.join(__dirname, '../fixtures');
const OUTPUT_FILE = path.join(__dirname, '../src/mock/fixtures.ts');

const processDirectory = (dir) => {
    let results = {};
    const files = fs.readdirSync(dir);

    files.forEach(file => {
        const fullPath = path.join(dir, file);
        const stat = fs.statSync(fullPath);

        if (stat.isDirectory()) {
            Object.assign(results, processDirectory(fullPath));
        } else if (file.endsWith('.org') && !file.endsWith('_archive')) {
            const content = fs.readFileSync(fullPath, 'utf8');
            results[file] = content;
        }
    });

    return results;
};

const generate = () => {
    console.log('Generating fixtures...');
    const workFixtures = processDirectory(path.join(FIXTURES_DIR, 'work'));
    const inFixtures = processDirectory(path.join(FIXTURES_DIR, 'in'));

    const allFixtures = { ...workFixtures, ...inFixtures };

    const fileContent = `// This file is auto-generated by scripts/generate-fixtures.js
// Do not edit manually

export const fixtures: Record<string, string> = ${JSON.stringify(allFixtures, null, 4)};
`;

    fs.writeFileSync(OUTPUT_FILE, fileContent);
    console.log(`Generated fixtures in ${OUTPUT_FILE}`);
    console.log(`Total files: ${Object.keys(allFixtures).length}`);
};

generate();
